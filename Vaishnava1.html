<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Registration Form</title>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-image: url('https://i.pinimg.com/736x/cb/cd/b7/cbcdb7948058162513a9852c4f96bfab.jpg');
      background-size: cover;
      background-attachment: fixed;
      margin: 0;
      padding: 20px;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 10px;
      max-width: 1000px;
      margin: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .child-entry {
      margin-top: 20px;
      padding: 15px;
      border: 1px dashed #666;
      border-radius: 10px;
    }
    .barcode-area {
      margin-top: 15px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #0066cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .status {
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Family Registration Form / కుటుంబ నమోదుపత్రం</h2>
    <form id="familyForm" onsubmit="saveData(event)">
      <label>First Name / మొదటి పేరు</label>
      <input type="text" id="pFirstName" required>
      <label>Last Name / చివరి పేరు</label>
      <input type="text" id="pLastName" required>
      <label>Age / వయస్సు</label>
      <input type="number" id="pAge" required>
      <label>Aadhar Number / ఆధార్ నంబర్</label>
      <input type="text" id="pAadhar" required>
      <label>Phone Number / ఫోన్ నంబర్</label>
      <input type="text" id="pPhone" required>
      <label>Date of Birth / పుట్టిన తేదీ</label>
      <input type="date" id="pDob" required>
      <label>Occupation / వృత్తి</label>
      <input type="text" id="pOccupation" required>
      <label>Blood Group / రక్త గ్రూప్</label>
      <select id="pBloodGroup" required>
        <option value="">Select / ఎంచుకోండి</option>
        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
        <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
      </select>
      <label>Marital Status / వివాహిత స్థితి</label>
      <input type="text" id="pMaritalStatus" required>
      <label>Address / చిరునామా</label>
      <textarea id="pAddress" required></textarea>

      <div class="barcode-area" id="primaryBarcode"></div>

      <hr>
      <h3>Add Children / పిల్లలను చేర్చండి</h3>
      <div id="childrenContainer"></div>
      <button type="button" onclick="addChild()">+ Add Child / పిల్ల చేర్చండి</button>
      <br>
      <button type="submit">Save / సేవ్ చేయండి</button>
    </form>
    <div class="status" id="status"></div>
  </div>

  <script>
    function showStatus(msg, success = true) {
      const s = document.getElementById("status");
      s.style.color = success ? "green" : "red";
      s.textContent = msg;
    }

    function generateBarcode(text, targetId) {
      const container = document.getElementById(targetId);
      container.innerHTML = `<svg id="barcode-${text}"></svg>`;
      JsBarcode(`#barcode-${text}`, text, {
        format: "CODE128",
        displayValue: true,
        lineColor: "#000",
        width: 2,
        height: 40
      });
    }

    function addChild() {
      const container = document.getElementById("childrenContainer");
      const idx = container.children.length;
      const div = document.createElement("div");
      div.className = "child-entry";
      div.innerHTML = `
        <label>First Name / మొదటి పేరు</label>
        <input name="cFirstName" required>
        <label>Last Name / చివరి పేరు</label>
        <input name="cLastName" required>
        <label>Age / వయస్సు</label>
        <input name="cAge" type="number" required>
        <label>Relation / సంబంధం</label>
        <select name="cRelation" required>
          <option value="">Select / ఎంచుకోండి</option>
          <option>Son / కుమారుడు</option><option>Daughter / కుమార్తె</option>
          <option>Brother / అన్న</option><option>Sister / అక్క</option>
          <option>Grandson / మనవడు</option><option>Granddaughter / మనవరాలు</option>
          <option>Other / ఇతర</option>
        </select>
        <label>Blood Group / రక్త గ్రూప్</label>
        <select name="cBloodGroup" required>
          <option value="">Select / ఎంచుకోండి</option>
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
        <div class="barcode-area" id="childBarcode${idx}"></div>
      `;
      container.appendChild(div);
    }

    function saveData(event) {
      event.preventDefault();
      const getVal = id => document.getElementById(id).value.trim();
      const requiredPrimary = ["pFirstName", "pLastName", "pAge", "pAadhar", "pPhone", "pDob", "pOccupation", "pBloodGroup", "pMaritalStatus", "pAddress"];
      for (let id of requiredPrimary) {
        if (!getVal(id)) {
          showStatus("Fill all primary fields correctly / అన్ని ప్రధాన వివరాలు నమోదు చేయండి", false);
          return;
        }
      }

      const primaryID = "P" + Date.now();
      const primaryData = {
        id: primaryID,
        firstName: getVal("pFirstName"),
        lastName: getVal("pLastName"),
        age: getVal("pAge"),
        aadhar: getVal("pAadhar"),
        phone: getVal("pPhone"),
        dob: getVal("pDob"),
        occupation: getVal("pOccupation"),
        bloodGroup: getVal("pBloodGroup"),
        maritalStatus: getVal("pMaritalStatus"),
        address: getVal("pAddress")
      };

      generateBarcode(primaryID, "primaryBarcode");

      const childBlocks = document.querySelectorAll(".child-entry");
      const childData = [];
      for (let i = 0; i < childBlocks.length; i++) {
        const child = childBlocks[i];
        const inputs = child.querySelectorAll("input, select, textarea");
        const data = {};
        for (let input of inputs) {
          if (!input.value.trim()) {
            showStatus("Fill all child fields / పిల్లల వివరాలు నమోదు చేయండి", false);
            return;
          }
          data[input.name] = input.value.trim();
        }
        data.id = "C" + Date.now() + i;
        generateBarcode(data.id, "childBarcode" + i);
        childData.push(data);
      }

      const allData = JSON.parse(localStorage.getItem("familyEntries") || "[]");
      allData.push({ primary: primaryData, children: childData });
      localStorage.setItem("familyEntries", JSON.stringify(allData));

      showStatus("✅ Data saved successfully / వివరాలు విజయవంతంగా సేవ్ చేయబడ్డాయి");

      setTimeout(() => {
        document.getElementById("familyForm").reset();
        document.getElementById("childrenContainer").innerHTML = "";
        document.getElementById("primaryBarcode").innerHTML = "";
      }, 3000);
    }
  </script>
</body>
</html>
